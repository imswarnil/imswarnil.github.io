<!-- Phosphor Icons (bold set) -->

<header class="island-navbar" role="navigation" aria-label="Primary" id="site-navbar">
  <a href="{{ '/' | relative_url }}" class="navbar-brand">
    {% if site.logo %}
      <img src="{{ site.logo | relative_url }}" alt="{{ site.title }}" class="navbar-avatar">
    {% else %}
      <img src="https://i.pravatar.cc/40?u={{ site.title | uri_escape }}" alt="{{ site.title }}" class="navbar-avatar">
    {% endif %}
    <span class="brand-text">
      <span class="logo">{{ site.title }}</span>
      <span class="logo-sub">
        {% if site.job_title %}{{ site.job_title }}{% elsif site.description %}{{ site.description }}{% else %}Website{% endif %}
      </span>
    </span>
  </a>

  <!-- Desktop nav (icons + text) -->
  <nav class="navbar-menu" aria-label="Desktop Navigation">
    <ul>
      {% for item in site.navigation_header %}
        <li>
          <a href="{{ item.url | relative_url }}" class="{% if page.url == item.url %}active{% endif %}">
            <i class="ph-bold ph-{{ item.icon | default: 'circle' }}"></i>
            {{ item.title }}
          </a>
        </li>
      {% endfor %}
    </ul>
  </nav>

  <div class="navbar-actions">
    <a href="{{ '/search/' | relative_url }}" class="button-icon button-sm button-transparent" aria-label="Search">
      <i class="ph-bold ph-magnifying-glass"></i>
    </a>

    <button class="theme-toggle-button button-icon button-sm" aria-label="Toggle theme" id="theme-toggle" aria-pressed="false">
      <i class="ph-bold ph-sun icon-sun" aria-hidden="true"></i>
      <i class="ph-bold ph-moon icon-moon" aria-hidden="true"></i>
    </button>

    {% if site.repo %}
      <a href="{{ site.repo }}" target="_blank" rel="noopener" class="button button-sm cta-github">
        <i class="ph-bold ph-star"></i><span>Star on GitHub</span>
      </a>
    {% endif %}

    <button class="mobile-menu-toggle button button-sm button-transparent button-icon"
            id="mobile-menu-toggle"
            aria-label="Open menu"
            aria-controls="mobile-panel"
            aria-expanded="false">
      <i class="ph-bold ph-list"></i>
    </button>
  </div>
</header>

<!-- Mobile floating island panel -->
<section id="mobile-panel" class="island-panel" aria-hidden="true">
  <div class="island-panel__inner">
    <nav class="bento-grid" aria-label="Quick navigation">
      {% for item in site.navigation_header %}
        <a class="bento-card" href="{{ item.url | relative_url }}">
          <span class="bento-icon"><i class="ph-bold ph-{{ item.icon | default: 'caret-right' }}"></i></span>
          <span>
            <div class="bento-title">{{ item.title }}</div>
            <div class="bento-sub">{{ item.subtitle | default: 'Open section' }}</div>
          </span>
        </a>
      {% endfor %}
      {% if site.repo %}
      <a class="bento-card" href="{{ site.repo }}" target="_blank" rel="noopener">
        <span class="bento-icon"><i class="ph-bold ph-github-logo"></i></span>
        <span>
          <div class="bento-title">GitHub</div>
          <div class="bento-sub">Open-source</div>
        </span>
      </a>
      {% endif %}
    </nav>
  </div>
</section>

<script>
  // 1) Prevent FOUC: decide theme before first paint
  (function () {
    var KEY = "color-scheme";
    var saved = localStorage.getItem(KEY);
    var system = (window.matchMedia && window.matchMedia("(prefers-color-scheme: dark)").matches) ? "dark" : "light";
    var theme = saved || system || "light";
    document.documentElement.setAttribute("data-color-scheme", theme);
  })();

  document.addEventListener("DOMContentLoaded", function () {
    var root   = document.documentElement;
    var KEY    = "color-scheme";
    var btn    = document.getElementById("theme-toggle");
    var panel  = document.getElementById("mobile-panel");
    var toggle = document.getElementById("mobile-menu-toggle");
    var bar    = document.getElementById("site-navbar");

    // 2) Fix mobile padding so fixed navbar doesnâ€™t overlap content
    function setNavHeightVar() {
      if (!bar) return;
      var h = bar.getBoundingClientRect().height;
      document.body.classList.add("has-fixed-nav");
      root.style.setProperty("--nav-h", h + "px");
    }
    setNavHeightVar();
    window.addEventListener("resize", setNavHeightVar);

    // 3) Theme switch (with soft animation handled by CSS)
    function getTheme(){ return root.getAttribute("data-color-scheme") || "light"; }
    function setTheme(t){
      root.setAttribute("data-color-scheme", t);
      localStorage.setItem(KEY, t);
      if (btn) btn.setAttribute("aria-pressed", String(t === "dark"));
    }
    setTheme(localStorage.getItem(KEY) || getTheme());
    if (btn) btn.addEventListener("click", function(){ setTheme(getTheme()==="light" ? "dark" : "light"); });

    // 4) Mobile panel (full height under the nav; inner scroll)
    function openPanel(){
      if (!panel || !toggle || !bar) return;
      bar.classList.add("is-open");
      panel.classList.add("is-open");
      panel.setAttribute("aria-hidden","false");
      toggle.setAttribute("aria-expanded","true");
    }
    function closePanel(){
      if (!panel || !toggle || !bar) return;
      bar.classList.remove("is-open");
      panel.classList.remove("is-open");
      panel.setAttribute("aria-hidden","true");
      toggle.setAttribute("aria-expanded","false");
    }
    function togglePanel(){ (panel && panel.classList.contains("is-open")) ? closePanel() : openPanel(); }

    if (toggle) toggle.addEventListener("click", togglePanel);
    if (panel)  panel.addEventListener("click", function(e){ if (e.target.closest("a")) closePanel(); });
    document.addEventListener("keydown", function(e){ if (e.key === "Escape" && panel && panel.classList.contains("is-open")) closePanel(); });

    // Close if switching to desktop
    var mq = window.matchMedia("(min-width: {{ site.bp_lg | default: '992px' }})");
    if (mq && mq.addEventListener) mq.addEventListener("change", function(){ if (mq.matches) closePanel(); });
  });
</script>
