

<!-- Optional spacer so content never hides behind the navbar -->
<div class="header-spacer" aria-hidden="true"></div>

<header id="site-navbar" role="navigation" aria-label="Primary">
  <a class="navbar-brand" href="{{ '/' | relative_url }}">
    {%- assign avatar = site.logo | default: '/assets/logos/logo.svg' -%}
    <img class="navbar-avatar" src="{{ avatar | relative_url }}" alt="{{ site.title }}">
    <span class="brand-text">
      <span class="logo">{{ site.title }}</span>
      <span class="logo-sub">
        {%- if site.job_title and site.job_title != '' -%}
          {{ site.job_title }}
        {%- else -%}
          {{ site.description }}
        {%- endif -%}
      </span>
    </span>
  </a>

  <nav class="navbar-menu" aria-label="Desktop Navigation">
    <ul>
      {%- for item in site.navigation_header -%}
        <li>
          <a href="{{ item.url | relative_url }}" class="{% if page.url == item.url %}active{% endif %}">
            {%- comment -%} Optional: add icon by title (edit mapping in include if you want) {%- endcomment -%}
            {%- assign t = item.title | downcase -%}
            {%- if t == 'home' -%}<i class="ph-bold ph-house"></i>{%- endif -%}
            {%- if t == 'blog' -%}<i class="ph-bold ph-article"></i>{%- endif -%}
            {%- if t == 'categories' -%}<i class="ph-bold ph-folders"></i>{%- endif -%}
            {%- if t == 'search' -%}<i class="ph-bold ph-magnifying-glass"></i>{%- endif -%}
            {{ item.title }}
          </a>
        </li>
      {%- endfor -%}
    </ul>
  </nav>

  <div class="navbar-actions">
    <button class="button-icon button-transparent" id="theme-toggle" aria-label="Toggle theme" aria-pressed="false">
      <i class="ph-bold ph-sun icon-sun" aria-hidden="true"></i>
      <i class="ph-bold ph-moon icon-moon" aria-hidden="true"></i>
    </button>
    <a class="button button-sm cta-github" href="{{ site.repo }}" target="_blank" rel="noopener">
      <i class="ph-bold ph-star"></i> <span>Star</span>
    </a>
    <button class="mobile-menu-toggle button button-sm button-transparent button-icon"
            id="mobile-menu-toggle"
            aria-label="Open menu"
            aria-controls="mobile-panel"
            aria-expanded="false">
      <i class="ph-bold ph-list"></i>
    </button>
  </div>
</header>

<section id="mobile-panel" class="island-panel" aria-hidden="true">
  <div class="island-panel__inner">
    <div class="bento-grid">
      {%- for item in site.navigation_header -%}
        <a class="bento-card" href="{{ item.url | relative_url }}">
          <span class="bento-icon">
            {%- assign t = item.title | downcase -%}
            {%- if t == 'home' -%}<i class="ph-bold ph-house"></i>{%- endif -%}
            {%- if t == 'blog' -%}<i class="ph-bold ph-article"></i>{%- endif -%}
            {%- if t == 'categories' -%}<i class="ph-bold ph-folders"></i>{%- endif -%}
            {%- if t == 'search' -%}<i class="ph-bold ph-magnifying-glass"></i>{%- endif -%}
            {%- if t == 'elements' -%}<i class="ph-bold ph-squares-four"></i>{%- endif -%}
            {%- if t == 'fork alembic' -%}<i class="ph-bold ph-github-logo"></i>{%- endif -%}
          </span>
          <span>
            <div class="bento-title">{{ item.title }}</div>
            <div class="bento-sub">{{ item.url }}</div>
          </span>
        </a>
      {%- endfor -%}
    </div>
  </div>
</section>

<script>
  // ===============================
// Header interactions
// ===============================
(function () {
  var root = document.documentElement;
  var KEY = "color-scheme";

  // Early set (in case no head guard)
  if (!root.getAttribute("data-color-scheme")) {
    try {
      var saved = localStorage.getItem(KEY);
      var system = window.matchMedia && window.matchMedia("(prefers-color-scheme: dark)").matches ? "dark" : "light";
      root.setAttribute("data-color-scheme", saved || system || "light");
    } catch (e) {
      root.setAttribute("data-color-scheme", "light");
    }
  }

  // THEME SWITCHER (start)
  var toggleBtn = document.getElementById("theme-toggle");
  function getTheme() { return root.getAttribute("data-color-scheme") || "light"; }
  function setTheme(t) {
    root.setAttribute("data-color-scheme", t);
    try { localStorage.setItem(KEY, t); } catch(e) {}
    if (toggleBtn) toggleBtn.setAttribute("aria-pressed", String(t === "dark"));
  }
  if (toggleBtn) {
    setTheme(getTheme()); // sync aria
    toggleBtn.addEventListener("click", function(){ setTheme(getTheme() === "light" ? "dark" : "light"); });
  }
  // THEME SWITCHER (end)

  // BENTO PANEL (start)
  var openBtn = document.getElementById("mobile-menu-toggle");
  var panel   = document.getElementById("mobile-panel");
  var navbar  = document.getElementById("site-navbar");

  function setPanelHeight(open) {
    if (!panel) return;
    if (open) {
      panel.style.maxHeight = "0px";
      requestAnimationFrame(function(){ panel.style.maxHeight = panel.scrollHeight + "px"; });
    } else {
      panel.style.maxHeight = panel.scrollHeight + "px";
      requestAnimationFrame(function(){ panel.style.maxHeight = "0px"; });
    }
  }
  function openPanel(){
    if (!panel || !navbar || !openBtn) return;
    navbar.classList.add("is-open");
    panel.classList.add("is-open");
    panel.setAttribute("aria-hidden","false");
    document.body.classList.add("panel-open");
    openBtn.setAttribute("aria-expanded","true");
    setPanelHeight(true);
  }
  function closePanel(){
    if (!panel || !navbar || !openBtn) return;
    navbar.classList.remove("is-open");
    panel.classList.remove("is-open");
    panel.setAttribute("aria-hidden","true");
    document.body.classList.remove("panel-open");
    openBtn.setAttribute("aria-expanded","false");
    setPanelHeight(false);
  }
  function togglePanel(){ panel && panel.classList.contains("is-open") ? closePanel() : openPanel(); }

  if (openBtn && panel) {
    openBtn.addEventListener("click", togglePanel);
    panel.addEventListener("click", function(e){ if (e.target.closest("a")) closePanel(); });
    document.addEventListener("keydown", function(e){ if (e.key === "Escape" && panel.classList.contains("is-open")) closePanel(); });
    window.addEventListener("resize", function(){ if(panel.classList.contains("is-open")) panel.style.maxHeight = panel.scrollHeight + "px"; });
    var mq = window.matchMedia("(min-width: 992px)");
    mq.addEventListener("change", function(){ if (mq.matches) closePanel(); });
  }
  // BENTO PANEL (end)
})();

</script>