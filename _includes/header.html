<!-- ===================================================================
header.html â€” dynamic island header + mobile bento + theme switcher
=================================================================== -->

<header class="island-navbar" role="navigation" aria-label="Primary" id="site-navbar">
<a href="{{ '/' | relative_url }}" class="navbar-brand">
{% if site.logo %}
 <img src="{{ site.logo | relative_url }}" alt="{{ site.title }}" class="navbar-avatar" />
{% else %}
 <img src="https://i.pravatar.cc/40?u={{ site.title | uri_escape }}" alt="{{ site.title }}" class="navbar-avatar" />
{% endif %}
<span class="brand-text">
 <span class="logo">{{ site.title }}</span>
 <span class="logo-sub">
   {% if site.job_title %}{{ site.job_title }}{% elsif site.description %}{{ site.description }}{% else %}Website{% endif %}
 </span>
</span>
</a>

<nav class="navbar-menu" aria-label="Desktop Navigation">
<ul>
 {% for item in site.navigation_header %}
   <li>
     <a href="{{ item.url | relative_url }}">{% if item.title %}{{ item.title }}{% else %}Link{% endif %}</a>
   </li>
 {% endfor %}
</ul>
</nav>

<div class="navbar-actions">
<a href="{{ '/search/' | relative_url }}" class="button-icon button-sm button-transparent" aria-label="Search">
 <i class="ph-bold ph-magnifying-glass" style="font-size: 1.25em;"></i>
</a>

<!-- Theme switcher -->
<button class="theme-toggle-button button-icon button-sm" aria-label="Toggle theme" id="theme-toggle" aria-pressed="false">
 <i class="ph-bold ph-sun" aria-hidden="true"></i>
</button>

{% if site.repo %}
 <a href="{{ site.repo }}" target="_blank" rel="noopener noreferrer" class="button button-sm cta-github">
   <i class="ph-bold ph-star"></i><span>Star</span>
 </a>
{% endif %}

<!-- Mobile menu toggle -->
<button class="mobile-menu-toggle button button-sm button-transparent button-icon" id="mobile-menu-toggle" aria-label="Open menu" aria-controls="mobile-panel" aria-expanded="false">
 <i class="ph-bold ph-list"></i>
</button>
</div>
</header>

<!-- Mobile bento panel -->
<section id="mobile-panel" class="island-panel" aria-hidden="true">
<div class="island-panel__inner">
<div class="bento-grid">
 {% for item in site.navigation_header %}
   <a class="bento-card" href="{{ item.url | relative_url }}">
     <span class="bento-icon"><i class="ph-bold ph-caret-right"></i></span>
     <span>
       <div class="bento-title">{{ item.title }}</div>
       <div class="bento-sub">{{ item.subtitle | default: 'Open section' }}</div>
     </span>
   </a>
 {% endfor %}
</div>
</div>
</section>

<!-- ===================================================================
Theme switcher + mobile panel JS (no external deps)
=================================================================== -->
<script>
// ----- FOUC guard (decide theme before first paint) -----
(function () {
var KEY = "color-scheme";
var saved = localStorage.getItem(KEY);
var system = (window.matchMedia && window.matchMedia("(prefers-color-scheme: dark)").matches) ? "dark" : "light";
var theme = saved || system || "light";
document.documentElement.setAttribute("data-color-scheme", theme);
})();

// ----- Interactive behaviors -----
document.addEventListener("DOMContentLoaded", function () {
var root = document.documentElement;

// THEME SWITCHER (start)
var KEY = "color-scheme";
var btnTheme = document.getElementById("theme-toggle");
function getTheme() { return root.getAttribute("data-color-scheme") || "light"; }
function setTheme(t) {
 root.setAttribute("data-color-scheme", t);
 localStorage.setItem(KEY, t);
 if (btnTheme) btnTheme.setAttribute("aria-pressed", t === "dark");
}
setTheme(localStorage.getItem(KEY) || getTheme());
if (btnTheme) btnTheme.addEventListener("click", function () {
 setTheme(getTheme() === "light" ? "dark" : "light");
});
// THEME SWITCHER (end)

// MOBILE PANEL (start)
var btnMenu = document.getElementById("mobile-menu-toggle");
var panel = document.getElementById("mobile-panel");
var navbar = document.getElementById("site-navbar");

function setPanelHeight(open) {
 if (!panel) return;
 if (open) {
   panel.style.maxHeight = "0px";
   requestAnimationFrame(function() {
     panel.style.maxHeight = panel.scrollHeight + "px";
   });
 } else {
   panel.style.maxHeight = panel.scrollHeight + "px";
   requestAnimationFrame(function() {
     panel.style.maxHeight = "0px";
   });
 }
}
function openPanel() {
 if (!panel || !btnMenu || !navbar) return;
 navbar.classList.add("is-open");
 panel.classList.add("is-open");
 panel.setAttribute("aria-hidden", "false");
 btnMenu.setAttribute("aria-expanded", "true");
 document.body.classList.add("panel-open");
 setPanelHeight(true);
}
function closePanel() {
 if (!panel || !btnMenu || !navbar) return;
 navbar.classList.remove("is-open");
 panel.classList.remove("is-open");
 panel.setAttribute("aria-hidden", "true");
 btnMenu.setAttribute("aria-expanded", "false");
 document.body.classList.remove("panel-open");
 setPanelHeight(false);
}
function togglePanel() {
 if (!panel) return;
 panel.classList.contains("is-open") ? closePanel() : openPanel();
}

if (btnMenu) btnMenu.addEventListener("click", togglePanel);
if (panel) panel.addEventListener("click", function (e) { if (e.target.closest("a")) closePanel(); });
document.addEventListener("keydown", function (e) { if (e.key === "Escape" && panel && panel.classList.contains("is-open")) closePanel(); });
window.addEventListener("resize", function () { if (panel && panel.classList.contains("is-open")) panel.style.maxHeight = panel.scrollHeight + "px"; });
var mq = window.matchMedia("(min-width: {{ $bp-lg | default: '992px' }})"); // harmless if literal
if (mq && mq.addEventListener) mq.addEventListener("change", function () { if (mq.matches) closePanel(); });
// MOBILE PANEL (end)
});
</script>
