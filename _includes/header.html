<!-- HEADER (Island Navbar) -->

<!-- Hard FOUC guard: decide theme before first paint -->
<script>
(function () {
  const KEY = "color-scheme";
  const saved = localStorage.getItem(KEY);
  const system = window.matchMedia && window.matchMedia("(prefers-color-scheme: dark)").matches ? "dark" : "light";
  const theme = saved || system || "light";
  document.documentElement.setAttribute("data-color-scheme", theme);
})();
</script>

<header class="island-navbar" role="navigation" aria-label="Primary" id="site-navbar">
  <a href="{{ '/' | relative_url }}" class="navbar-brand">
    <img
      src="{{ site.owner.avatar | default: 'https://i.pravatar.cc/40?u=jekyll' }}"
      alt="{{ site.owner.name | default: site.title | default: 'Site Owner' }}"
      class="navbar-avatar" />
    <span class="brand-text">
      <span class="logo">{{ site.owner.name | default: site.title | default: "Your Name" }}</span>
      <span class="logo-sub">
        {{ site.owner.job_title | default: "Software Engineer" }}
      </span>
    </span>
  </a>

  <nav class="navbar-menu" aria-label="Desktop Navigation">
    <ul>
      <li><a href="{{ '/' | relative_url }}"><i class="ph-bold ph-house"></i>Home</a></li>
      <li><a href="{{ '/#about' | relative_url }}"><i class="ph-bold ph-user"></i>About</a></li>
      <li><a href="{{ '/#projects' | relative_url }}"><i class="ph-bold ph-folder"></i>Projects</a></li>
      <li><a href="{{ '/blog/' | relative_url }}"><i class="ph-bold ph-article"></i>Blog</a></li>
      <li><a href="{{ '/#contact' | relative_url }}"><i class="ph-bold ph-paper-plane-tilt"></i>Contact</a></li>
    </ul>
  </nav>

  <div class="navbar-actions">
    <a href="#" id="search-open" class="button-icon button-sm button-transparent" aria-label="Search">
      <i class="ph-bold ph-magnifying-glass"></i>
    </a>

    <button class="theme-toggle-button button-icon button-sm" aria-label="Toggle theme" id="theme-toggle">
      <i class="ph-bold ph-sun icon-sun" aria-hidden="true"></i>
      <i class="ph-bold ph-moon icon-moon" aria-hidden="true"></i>
    </button>

    <a href="{{ site.owner.github | default: 'https://github.com' }}" target="_blank" rel="noopener noreferrer" class="button button-sm cta-github">
      <i class="ph-bold ph-star"></i><span>Star on GitHub</span>
    </a>

    <button class="mobile-menu-toggle button button-sm button-transparent button-icon"
            id="mobile-menu-toggle"
            aria-label="Open menu"
            aria-controls="mobile-panel"
            aria-expanded="false">
      <i class="ph-bold ph-list"></i>
    </button>
  </div>
</header>

<!-- Mobile floating backdrop -->
<div class="mobile-backdrop" id="mobile-backdrop" aria-hidden="true"></div>

<!-- Floating Mobile Island Panel -->
<section id="mobile-panel" class="island-panel" aria-hidden="true">
  <div class="island-panel__inner">
    <nav class="bento" aria-label="Quick actions">
      <a class="bento-item col-3" href="{{ '/#about' | relative_url }}">
        <span class="bento-icon"><i class="ph-bold ph-user"></i></span>
        <span class="bento-content"><span class="bento-title">About</span><span class="bento-sub">Who I am</span></span>
      </a>
      <a class="bento-item col-3" href="{{ '/#projects' | relative_url }}">
        <span class="bento-icon"><i class="ph-bold ph-folder"></i></span>
        <span class="bento-content"><span class="bento-title">Projects</span><span class="bento-sub">Featured work</span></span>
      </a>
      <a class="bento-item col-3" href="{{ '/blog/' | relative_url }}">
        <span class="bento-icon"><i class="ph-bold ph-article"></i></span>
        <span class="bento-content"><span class="bento-title">Blog</span><span class="bento-sub">Notes & essays</span></span>
      </a>
      <a class="bento-item col-3" href="{{ '/#contact' | relative_url }}">
        <span class="bento-icon"><i class="ph-bold ph-paper-plane-tilt"></i></span>
        <span class="bento-content"><span class="bento-title">Contact</span><span class="bento-sub">Say hello</span></span>
      </a>
      <a class="bento-item col-3" href="{{ site.owner.github | default: 'https://github.com' }}" target="_blank" rel="noopener">
        <span class="bento-icon"><i class="ph-bold ph-github-logo"></i></span>
        <span class="bento-content"><span class="bento-title">GitHub</span><span class="bento-sub">Open source</span></span>
      </a>
      <a class="bento-item col-3" href="{{ '/resume.pdf' | relative_url }}" download>
        <span class="bento-icon"><i class="ph-bold ph-file-text"></i></span>
        <span class="bento-content"><span class="bento-title">Résumé</span><span class="bento-sub">One-pager</span></span>
      </a>
    </nav>
  </div>
</section>

<!-- Optional Person JSON-LD -->
<script type="application/ld+json">
{
  "@context":"https://schema.org",
  "@type":"Person",
  "name":"{{ site.owner.name | default: site.title | default: 'Your Name' | escape }}",
  "jobTitle":"{{ site.owner.job_title | default: 'Software Engineer' | escape }}",
  "url":"{{ site.url | append: site.baseurl }}",
  "image":"{{ site.owner.avatar | default: 'https://i.pravatar.cc/200?u=jekyll' }}",
  "sameAs":[
    {% if site.owner.github %}"{{ site.owner.github }}"{% endif %}
  ]
}
</script>

<script>
document.addEventListener("DOMContentLoaded", function () {
  const root = document.documentElement;
  const KEY = "color-scheme";
  const themeBtn = document.getElementById("theme-toggle");
  const mobileBtn = document.getElementById("mobile-menu-toggle");
  const mobilePanel = document.getElementById("mobile-panel");
  const navbar = document.getElementById("site-navbar");
  const backdrop = document.getElementById("mobile-backdrop");

  // Stick on desktop, fixed on mobile (add body padding to avoid jump)
  function setBodyPad() {
    const isMobile = window.matchMedia("(max-width: 991px)").matches;
    document.body.classList.toggle("has-fixed-nav", isMobile);
  }
  setBodyPad();
  window.addEventListener("resize", setBodyPad);

  // Theme
  function getTheme(){ return root.getAttribute("data-color-scheme") || "light"; }
  function setTheme(theme){
    root.setAttribute("data-color-scheme", theme);
    localStorage.setItem(KEY, theme);
    themeBtn?.setAttribute("aria-pressed", theme === "dark");
  }
  setTheme(localStorage.getItem(KEY) || getTheme());
  themeBtn?.addEventListener("click", () => {
    const next = getTheme() === "light" ? "dark" : "light";
    // tiny crossfade for niceness
    root.classList.add("theming");
    setTheme(next);
    setTimeout(()=> root.classList.remove("theming"), 220);
  });

  // Mobile island
  function setPanelHeight(open){
    if(open){
      mobilePanel.style.maxHeight = "0px";
      requestAnimationFrame(()=>{ mobilePanel.style.maxHeight = mobilePanel.scrollHeight + "px"; });
    } else {
      mobilePanel.style.maxHeight = mobilePanel.scrollHeight + "px";
      requestAnimationFrame(()=>{ mobilePanel.style.maxHeight = "0px"; });
    }
  }
  function openPanel(){
    navbar.classList.add("is-open");
    mobilePanel.classList.add("is-open");
    mobilePanel.setAttribute("aria-hidden","false");
    document.body.classList.add("panel-open");
    mobileBtn.setAttribute("aria-expanded","true");
    backdrop && backdrop.classList.add("is-open");
    setPanelHeight(true);
  }
  function closePanel(){
    navbar.classList.remove("is-open");
    mobilePanel.classList.remove("is-open");
    mobilePanel.setAttribute("aria-hidden","true");
    document.body.classList.remove("panel-open");
    mobileBtn.setAttribute("aria-expanded","false");
    backdrop && backdrop.classList.remove("is-open");
    setPanelHeight(false);
  }
  function togglePanel(){ mobilePanel.classList.contains("is-open") ? closePanel() : openPanel(); }

  mobileBtn?.addEventListener("click", togglePanel);
  backdrop?.addEventListener("click", closePanel);
  mobilePanel.addEventListener("click", (e)=>{ if(e.target.closest("a")) closePanel(); });
  document.addEventListener("keydown", (e)=>{ if(e.key==="Escape" && mobilePanel.classList.contains("is-open")) closePanel(); });

  // Recalc height if open and viewport changes
  window.addEventListener("resize", ()=>{ if(mobilePanel.classList.contains("is-open")) mobilePanel.style.maxHeight = mobilePanel.scrollHeight + "px"; });

  // Close when switching to desktop
  window.matchMedia("(min-width: 992px)").addEventListener("change", (mq)=>{ if(mq.matches) closePanel(); });
});
</script>
