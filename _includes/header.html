<!-- ===================================================================
header.html â€” Island Navbar + Theme Switcher + Mobile Bento Panel
Uses: site.title, site.job_title, site.logo or site.avatarurl,
      site.navigation_header
Icons: Phosphor (CSS build)
=================================================================== -->

<!-- Icons (CSS build for <i class="ph-...">) -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@phosphor-icons/web@2.1.2/src/bold/style.css">

<header class="island-navbar" role="navigation" aria-label="Primary" id="site-navbar">
<a class="navbar-brand" href="{{ '/' | relative_url }}">
{% assign avatar_src = site.avatarurl | default: site.logo %}
{% if avatar_src %}
 <img class="navbar-avatar" src="{{ avatar_src | relative_url }}" alt="{{ site.title }}">
{% endif %}
<span class="brand-text">
 <span class="logo">{{ site.title }}</span>
 <span class="logo-sub">{{ site.job_title | default: site.description }}</span>
</span>
</a>

<nav class="navbar-menu" aria-label="Desktop Navigation">
<ul>
 {% for item in site.navigation_header %}
   <li>
     <a href="{{ item.url | relative_url }}" {% if item.url == page.url %}class="active"{% endif %}>
       {% if item.icon %}<i class="ph-bold ph-{{ item.icon }}"></i>{% endif %}
       {{ item.title }}
     </a>
   </li>
 {% endfor %}
</ul>
</nav>

<div class="navbar-actions">
<a class="button-icon button--sm button--ghost" href="{{ '/search/' | relative_url }}" aria-label="Search">
 <i class="ph-bold ph-magnifying-glass"></i>
</a>

<!-- THEME SWITCHER : start -->
<button class="theme-toggle-button" id="theme-toggle" aria-label="Toggle theme" aria-pressed="false">
 <i class="ph-bold ph-sun"></i>
</button>
<!-- THEME SWITCHER : end -->

{% if site.repo %}
 <a class="cta-github button--sm" href="{{ site.repo }}" target="_blank" rel="noopener">
   <i class="ph-bold ph-star"></i><span>Star</span>
 </a>
{% endif %}

<button class="mobile-menu-toggle" id="mobile-menu-toggle" aria-label="Open menu" aria-controls="mobile-panel" aria-expanded="false">
 <i class="ph-bold ph-list"></i>
</button>
</div>
</header>

<!-- Mobile expanding panel (Bento) -->
<section id="mobile-panel" class="island-panel" aria-hidden="true">
<div class="island-panel__inner">
<div class="bento-grid">
 {% for item in site.navigation_header %}
   <a class="bento-card" href="{{ item.url | relative_url }}">
     <span class="bento-icon">
       <i class="ph-bold {% if item.icon %}ph-{{ item.icon }}{% else %}ph-caret-right{% endif %}"></i>
     </span>
     <span>
       <div class="bento-title">{{ item.title }}</div>
       <div class="bento-sub">
         {% if item.subtitle %}{{ item.subtitle }}{% else %}Open{% endif %}
       </div>
     </span>
   </a>
 {% endfor %}
</div>
</div>
</section>

<!-- ===================================================================
Header scripts (self-contained)
=================================================================== -->
<script>
// ===== THEME: load ASAP to minimize FOUC (best-effort in body include) =====
(function () {
try {
 var KEY = "color-scheme";
 var root = document.documentElement;
 var saved = localStorage.getItem(KEY);
 if (!saved) {
   var prefersDark = window.matchMedia && window.matchMedia("(prefers-color-scheme: dark)").matches;
   root.setAttribute("data-color-scheme", prefersDark ? "dark" : "light");
 } else {
   root.setAttribute("data-color-scheme", saved);
 }
} catch (e) {}
})();

document.addEventListener("DOMContentLoaded", function () {
var root = document.documentElement;

// ===== THEME SWITCHER : start =====
var KEY = "color-scheme";
var toggle = document.getElementById("theme-toggle");

function getTheme() {
 return root.getAttribute("data-color-scheme") || "light";
}
function setTheme(t) {
 root.setAttribute("data-color-scheme", t);
 try { localStorage.setItem(KEY, t); } catch (e) {}
 if (toggle) toggle.setAttribute("aria-pressed", t === "dark");
}

setTheme(localStorage.getItem(KEY) || getTheme());
if (toggle) {
 toggle.addEventListener("click", function () {
   setTheme(getTheme() === "light" ? "dark" : "light");
 });
}
// ===== THEME SWITCHER : end =====

// ===== MOBILE PANEL =====
var btn = document.getElementById("mobile-menu-toggle");
var panel = document.getElementById("mobile-panel");
var navbar = document.getElementById("site-navbar");

function setPanelHeight(open) {
 if (!panel) return;
 if (open) {
   panel.style.maxHeight = "0px";
   requestAnimationFrame(function () {
     panel.style.maxHeight = panel.scrollHeight + "px";
   });
 } else {
   panel.style.maxHeight = panel.scrollHeight + "px";
   requestAnimationFrame(function () {
     panel.style.maxHeight = "0px";
   });
 }
}

function openPanel() {
 if (!panel || !btn || !navbar) return;
 navbar.classList.add("is-open");
 panel.classList.add("is-open");
 panel.setAttribute("aria-hidden", "false");
 document.body.classList.add("panel-open");
 btn.setAttribute("aria-expanded", "true");
 setPanelHeight(true);
}

function closePanel() {
 if (!panel || !btn || !navbar) return;
 navbar.classList.remove("is-open");
 panel.classList.remove("is-open");
 panel.setAttribute("aria-hidden", "true");
 document.body.classList.remove("panel-open");
 btn.setAttribute("aria-expanded", "false");
 setPanelHeight(false);
}

function togglePanel() {
 if (!panel) return;
 if (panel.classList.contains("is-open")) closePanel();
 else openPanel();
}

if (btn) btn.addEventListener("click", togglePanel);
if (panel) {
 panel.addEventListener("click", function (e) {
   if (e.target.closest("a")) closePanel();
 });
}
document.addEventListener("keydown", function (e) {
 if (e.key === "Escape" && panel && panel.classList.contains("is-open")) closePanel();
});
var mq = window.matchMedia("(min-width: {{  site.bp_lg | default: '992px'  }})");
// If you don't define site.bp_lg, it just uses the default 992px threshold
if (mq && mq.addEventListener) {
 mq.addEventListener("change", function () { if (mq.matches) closePanel(); });
}
window.addEventListener("resize", function () {
 if (panel && panel.classList.contains("is-open")) {
   panel.style.maxHeight = panel.scrollHeight + "px";
 }
});
});
</script>
