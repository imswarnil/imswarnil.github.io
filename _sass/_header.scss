// ======================================================================
// _header.scss — island navbar with in-place mobile expando + search mode
// uses: _variables.scss tokens & mixins (no button styles here)
// ======================================================================

.island-navbar {
  @include container;
  position: sticky;
  top: $container-gutter;
  z-index: $z-header;

  display: grid;
  grid-template-columns: auto 1fr auto;
  align-items: center;
  gap: $sp-5;

  margin: 0 auto $sp-6;
  padding: $sp-3 $sp-6;
  border: 1px solid;
  border-radius: $radius-6;
  backdrop-filter: blur(12px);

  transition:
    background-color $dur-2 $ease-in-out,
    border-color $dur-2 $ease-in-out,
    border-radius $dur-2 $ease-in-out,
    box-shadow $dur-2 $ease-in-out;

  @include theme-block {
    background-color: rgba(255,255,255,0.72);
    border-color: tone(border, light);
    box-shadow: $shadow-light;
  }
  @include theme-block-dark {
    background-color: rgba(20,20,22,0.74);
    border-color: tone(border, dark);
    box-shadow: $shadow-dark;
  }

  &.is-open {
    border-bottom-left-radius: $radius-4;
    border-bottom-right-radius: $radius-4;
  }

  // fixed on mobile for “floating” feel
  @media (max-width: $bp-lg) {
    position: fixed;
    top: 0; left: 0; right: 0;
    width: 100%;
    border-radius: 0;
    margin: 0;
    padding-left: $container-gutter;
    padding-right: $container-gutter;
  }
}

body.has-fixed-nav {
  padding-top: var(--nav-h, #{$navbar-height});
}

/* ---------- Brand ---------- */
.navbar-brand {
  display: inline-flex; align-items: center; gap: $sp-5; text-decoration: none;

  .navbar-avatar {
    width: 2rem; height: 2rem;
    border-radius: 50%; object-fit: cover; border: 2px solid;
    @include theme-block      { border-color: tone(border, light); }
    @include theme-block-dark { border-color: tone(border, dark); }
  }

  .brand-text { display: grid; line-height: 1.1; }
  .logo {
    font-size: $fs-4;
    font-weight: $fw-semibold;
    letter-spacing: -0.01em;
    @include theme-block      { color: tone(contrast, light); }
    @include theme-block-dark { color: tone(contrast, dark); }
  }
  .logo-sub {
    font-size: $fs-1;
    @include theme-block      { color: tone(secondary, light); }
    @include theme-block-dark { color: tone(secondary, dark); }
  }
}

/* ---------- Desktop menu ---------- */
.navbar-menu {
  justify-self: center;

  ul { display: flex; align-items: center; gap: $sp-2; margin: 0; padding: 0; list-style: none; }

  a {
    display: inline-flex; align-items: center; gap: .5em;
    padding: $sp-3 $sp-5;
    font-size: $fs-3; // compact
    font-weight: $fw-medium;
    border-radius: $radius-pill;
    transition: background-color $dur-1, color $dur-1;

    i { font-size: $fs-4; line-height: 1; }

    @include theme-block {
      color: tone(secondary, light);
      &:hover, &.active { color: tone(contrast, light); background: tone(background-100, light); }
    }
    @include theme-block-dark {
      color: tone(secondary, dark);
      &:hover, &.active { color: tone(contrast, dark); background: tone(background-100, dark); }
    }
  }

  @media (max-width: $bp-lg) { display: none; }
}

/* ---------- Actions (icon sizes only; your button.scss can style further) ---------- */
.navbar-actions {
  display: inline-flex; align-items: center; gap: $sp-3; justify-self: end;

  .nav-icon {
    width: $btn-height-sm; height: $btn-height-sm;
    display: inline-grid; place-items: center;
    border: 1px solid; border-radius: 50%; background: transparent; cursor: pointer;
    @include theme-block      { color: tone(secondary, light); border-color: tone(border, light); }
    @include theme-block-dark { color: tone(secondary, dark);  border-color: tone(border, dark); }
    &:hover {
      @include theme-block      { background: tone(background-200, light); color: tone(contrast, light); }
      @include theme-block-dark { background: tone(background-200, dark);  color: tone(contrast, dark);  }
    }
    i { font-size: $fs-4; }
  }

  .cta-github {
    display: inline-flex; align-items: center; gap: .5em;
    padding: $sp-3 $sp-5; border-radius: $radius-pill; border: 1px solid transparent; text-decoration: none;
    font-size: $fs-3; font-weight: $fw-semibold;
    @include theme-block      { background: tone(contrast, light); color: tone(white, light); }
    @include theme-block-dark { background: tone(white, dark);    color: tone(black, dark);  }
    &:hover { transform: translateY(-1px); }
    span { display: none; }
    @include mq-up($bp-md) { span { display: inline; } }
  }

  .mobile-menu-toggle { display: none; }
  @media (max-width: $bp-lg) { .mobile-menu-toggle { display: inline-grid; } }
}

/* ---------- IN-HEADER Expando (mobile) ---------- */
.navbar-expando {
  grid-column: 1 / -1;
  border-top: 0;
  margin: 0;
  overflow: clip;

  // start collapsed
  max-height: 0;
  opacity: 0;
  pointer-events: none;
  transform: translateY(-4px);
  transition: max-height 500ms $ease-in-out, opacity 300ms ease, transform 350ms $ease-in-out;

  .expando-divider {
    height: 1px; margin: $sp-3 (-$sp-6) $sp-6;
    @include theme-block      { background: rgba(0,0,0,.08); }
    @include theme-block-dark { background: rgba(255,255,255,.10); }
  }

  .bento-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: $sp-5;
    padding-bottom: $sp-4;

    @include mq-up($bp-sm) { grid-template-columns: repeat(3, 1fr); }
  }

  .bento-card {
    display: flex; align-items: center; gap: $sp-4;
    padding: $sp-5; border-radius: $radius-4; border: 1px solid;
    text-decoration: none;
    transition: transform $dur-1 ease, background $dur-1 ease;

    @include theme-block      { background: tone(surface, light);       border-color: tone(border, light); color: tone(contrast, light); }
    @include theme-block-dark { background: tone(background-100, dark); border-color: tone(border, dark);  color: tone(contrast, dark);  }
    &:hover {
      transform: translateY(-2px);
      @include theme-block      { background: tone(background-100, light); }
      @include theme-block-dark { background: tone(background-100, dark);  }
    }

    .bento-icon {
      width: 2.25rem; height: 2.25rem; display: grid; place-items: center;
      border-radius: $radius-3; border: 1px solid;
      @include theme-block      { border-color: tone(border, light); }
      @include theme-block-dark { border-color: tone(border, dark);  }
      i { font-size: $fs-4; }
    }
    .bento-title { font-weight: $fw-semibold; font-size: $fs-3; }
    .bento-sub   { font-size: $fs-2; @include theme-block { color: tone(secondary, light); } @include theme-block-dark { color: tone(secondary, dark); } }
  }

  // open state (mobile only)
  &.is-open {
    max-height: 70vh;
    opacity: 1;
    pointer-events: auto;
    transform: translateY(0);
  }

  @include mq-up($bp-lg) { display: none; }
}

/* ---------- Search mode (transforms header into a search bar) ---------- */
.navbar-search {
  display: none; // revealed by .is-searching
  grid-column: 1 / -1;

  .search-field {
    display: grid; grid-template-columns: auto 1fr; align-items: center; gap: $sp-4;
    padding: $sp-4 $sp-5; border: 1px solid; border-radius: $radius-4;

    @include theme-block      { background: tone(surface, light);       border-color: tone(border, light); }
    @include theme-block-dark { background: tone(background-100, dark); border-color: tone(border, dark);  }

    i { font-size: $fs-4; @include theme-block { color: tone(secondary, light); } @include theme-block-dark { color: tone(secondary, dark); } }
    input {
      background: transparent; border: 0; outline: none; font: inherit; line-height: $lh-base;
      @include theme-block      { color: tone(contrast, light); }
      @include theme-block-dark { color: tone(contrast, dark);    }
    }
  }

  .search-actions {
    display: inline-flex; gap: $sp-3; margin-top: $sp-4;
    .search-btn, .cancel-btn {
      padding: $sp-3 $sp-5; border-radius: $radius-pill; border: 1px solid; cursor: pointer; background: transparent; font-weight: $fw-semibold;
    }
    .search-btn {
      @include theme-block      { background: tone(contrast, light); color: tone(white, light); border-color: transparent; }
      @include theme-block-dark { background: tone(white, dark);    color: tone(black, dark);  border-color: transparent; }
    }
    .cancel-btn {
      @include theme-block      { color: tone(secondary, light); border-color: tone(border, light); }
      @include theme-block-dark { color: tone(secondary, dark);  border-color: tone(border, dark);  }
      &:hover {
        @include theme-block      { background: tone(background-200, light); color: tone(contrast, light); }
        @include theme-block-dark { background: tone(background-200, dark);  color: tone(contrast, dark);  }
      }
    }
  }

  .search-suggestions {
    margin-top: $sp-4; display: none;
    &.has-results { display: block; }
    ul { list-style: none; margin: 0; padding: 0; display: grid; gap: $sp-2; }
    a {
      display: block; padding: $sp-3 $sp-4; border-radius: $radius-3; border: 1px solid; text-decoration: none;
      @include theme-block      { color: tone(contrast, light); border-color: tone(border, light); background: tone(surface, light); }
      @include theme-block-dark { color: tone(contrast, dark);   border-color: tone(border, dark);  background: tone(background-100, dark); }
      &:hover {
        @include theme-block      { background: tone(background-100, light); }
        @include theme-block-dark { background: tone(background-100, dark);  }
      }
    }
  }
}

/* Toggle layout pieces during search */
.island-navbar.is-searching {
  grid-template-columns: 1fr; // full-width search
}
.island-navbar.is-searching .navbar-brand,
.island-navbar.is-searching .navbar-menu,
.island-navbar.is-searching .navbar-actions { display: none; }
.island-navbar.is-searching .navbar-search { display: block; }
