<!DOCTYPE html>
<html lang="{{ site.lang | default: "en-US" }}">

  <head>
    <!-- General meta -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    {% if page.indexing == false %}
      <meta name="robots" content="noindex">
    {% endif %}

    {% if page.collectionpage %}
      {% seo title=false %}

      {% assign collectiondata = site.collections | where: "label", page.collectionpage | first %}
      <title>{{ collectiondata.title }} - {{ site.title }}</title>
      <meta property="og:title" content="{{ collectiondata.title }}">
      <meta name="description" content="{{ collectiondata.description }}">
      <meta property="og:description" content="{{ collectiondata.description }}">
    {% else %}
      {% seo %}
    {% endif %}
    {% if site.fonts.preconnect_urls %}
      {% for url in site.fonts.preconnect_urls %}
        <link rel="preconnect" href="{{ url }}" crossorigin />
      {% endfor %}
    {% endif %}

    <link rel="manifest" href="{{ "/manifest.json" | relative_url }}">
    <meta name="theme-color" content="{{ site.manifest.theme_color | default: '#242e2b' }}"/>

    {% if site.css_inline == true %}
      {% include site-styles.html %}
    {% else %}
      <link rel="stylesheet" href="{{ "/assets/styles.css" | relative_url }}">
    {% endif %}

    {% if site.favicons or site.avatarurl %}{% include site-favicons.html %}{% endif %}

    {% if site.google_analytics %}{% include site-analytics.html %}{% endif %}

    {% include site-fonts.html %}

    {% include site-before-start.html %}
  </head>

  <body class="layout-{{ page.layout }}{% if page.title %}  {{ page.title | slugify }}{% endif %}">
    {% include site-icons.svg %}

    {{ content }}

    {% if site.service_worker != false %}{% include site-sw.html %}{% endif %}

    {% include site-before-end.html %}
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const root = document.documentElement;
  
        // ---- THEME ----
        const KEY = "color-scheme";
        const themeToggleBtn = document.getElementById("theme-toggle");
        function getTheme(){ return root.getAttribute("data-color-scheme") || "light"; }
        function setTheme(theme){ root.setAttribute("data-color-scheme", theme); localStorage.setItem(KEY, theme); themeToggleBtn?.setAttribute("aria-pressed", theme === "dark"); }
        setTheme(localStorage.getItem(KEY) || getTheme());
        themeToggleBtn?.addEventListener("click", () => setTheme(getTheme()==="light"?"dark":"light"));
  
        // ---- EXPANDING ISLAND PANEL ----
        const mobileMenuToggle = document.getElementById("mobile-menu-toggle");
        const mobilePanel = document.getElementById("mobile-panel");
        const navbar = document.getElementById("site-navbar");
  
        function setPanelHeight(open){
          if(open){
            mobilePanel.style.maxHeight = "0px";
            requestAnimationFrame(()=>{ mobilePanel.style.maxHeight = mobilePanel.scrollHeight + "px"; });
          } else {
            mobilePanel.style.maxHeight = mobilePanel.scrollHeight + "px";
            requestAnimationFrame(()=>{ mobilePanel.style.maxHeight = "0px"; });
          }
        }
        function openPanel(){ navbar.classList.add("is-open"); mobilePanel.classList.add("is-open"); mobilePanel.setAttribute("aria-hidden","false"); document.body.classList.add("panel-open"); mobileMenuToggle.setAttribute("aria-expanded","true"); setPanelHeight(true); }
        function closePanel(){ navbar.classList.remove("is-open"); mobilePanel.classList.remove("is-open"); mobilePanel.setAttribute("aria-hidden","true"); document.body.classList.remove("panel-open"); mobileMenuToggle.setAttribute("aria-expanded","false"); setPanelHeight(false); }
        function togglePanel(){ mobilePanel.classList.contains("is-open")?closePanel():openPanel(); }
  
        mobileMenuToggle?.addEventListener("click", togglePanel);
        mobilePanel.addEventListener("click", (e)=>{ if(e.target.closest("a")) closePanel(); });
        document.addEventListener("keydown", (e)=>{ if(e.key==="Escape" && mobilePanel.classList.contains("is-open")) closePanel(); });
        window.addEventListener("resize", ()=>{ if(mobilePanel.classList.contains("is-open")) mobilePanel.style.maxHeight = mobilePanel.scrollHeight + "px"; });
        const mq = window.matchMedia("(min-width: 992px)"); mq.addEventListener("change", ()=>{ if(mq.matches) closePanel(); });
      });
    </script>
  </body>

</html>
